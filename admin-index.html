<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>부동산 물건 관리 시스템 | 관리자</title>
  <link rel="stylesheet" href="./admin-styles.css" />
</head>
<body>
  <div class="admin-shell">
    <header class="admin-topbar">
      <div class="brand">
        <div class="brand-dot"></div>
        <div>
          <h1 id="adminPageTitle">관리자 페이지</h1>
          <p id="adminPageSubtitle">물건 · 담당자 · 지역배정 · 중개사무소 관리</p>
        </div>
      </div>

      <div class="top-actions">
        <span id="adminUserBadge" class="badge badge-muted">비로그인</span>
        <button id="btnAdminLoginOpen" class="btn btn-primary">로그인</button>
        <button id="btnAdminLogout" class="btn btn-ghost hidden">로그아웃</button>
      </div>
    </header>

    <main class="admin-main">
      <!-- 대시보드 요약 -->
      <section class="panel summary-panel">
        <div class="summary-grid">
          <div class="summary-card"><span>전체 물건</span><strong id="sumTotal">0</strong></div>
          <div class="summary-card"><span>경매</span><strong id="sumAuction">0</strong></div>
          <div class="summary-card"><span>공매</span><strong id="sumGongmae">0</strong></div>
          <div class="summary-card"><span>일반</span><strong id="sumGeneral">0</strong></div>
          <div class="summary-card"><span>담당자 수</span><strong id="sumAgents">0</strong></div>
          <div class="summary-card"><span>중개사무소 수</span><strong id="sumOffices">0</strong></div>
        </div>
      </section>

      <!-- 탭 -->
      <section class="panel">
        <div class="tabs" id="adminTabs">
          <button class="tab is-active" data-tab="properties">물건 관리</button>
          <button class="tab" data-tab="csv">CSV 업로드</button>
          <button class="tab" data-tab="staff">담당자 관리</button>
          <button class="tab" data-tab="regions">담당자 지역 배정</button>
          <button class="tab" data-tab="offices">중개사무소 정보</button>
        </div>
      </section>

      <!-- 물건 관리 -->
      <section id="tab-properties" class="panel tab-panel">
        <div class="panel-title-row">
          <h2>물건 리스팅</h2>
          <div class="btn-row">
          <button id="btnPropNew" class="btn btn-primary">신규 등록</button>
          <button id="btnReloadProperties" class="btn btn-secondary">새로고침</button>
        </div>
      </div>

      <div id="propertiesRoleNote" class="muted small"></div>

        <div class="toolbar">
          <select id="propSourceFilter" class="select">
            <option value="">전체 소스</option>
            <option value="auction">경매</option>
            <option value="gongmae">공매</option>
            <option value="general">일반</option>
          </select>

          <select id="propStatusFilter" class="select">
            <option value="">전체 상태</option>
            <option value="active">진행중</option>
            <option value="hold">보류</option>
            <option value="closed">종결</option>
            <option value="review">검토중</option>
          </select>

          <input id="propKeyword" class="input" type="text" placeholder="주소 / 담당자 검색" />
        </div>

        <div class="table-wrap">
          <table class="table" id="propertiesTable">
            <thead>
              <tr>
                <th>소스</th>
                <th>주소</th>
                <th>매각가</th>
                <th>상태</th>
                <th>담당자</th>
                <th>지역(구/동)</th>
                <th>중복</th>
                <th>등록일</th>
              <th>작업</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="propertiesEmpty" class="empty hidden">표시할 물건이 없습니다.</div>
        </div>
      </section>

      <!-- CSV 업로드 -->
      <section id="tab-csv" class="panel tab-panel hidden">
        <div class="panel-title-row">
          <h2>경매 / 공매 CSV 업로드</h2>
        </div>

        <div class="sub-card">
          <div class="field-row">
            <label class="field">
              <span>업로드 대상</span>
              <select id="csvImportSource" class="select">
                <option value="auction">경매 CSV</option>
                <option value="gongmae">공매 CSV</option>
              </select>
            </label>

            <label class="field">
              <span>CSV 파일</span>
              <input id="csvFileInput" class="input" type="file" accept=".csv,text/csv" />
            </label>
          </div>

          <div class="hint-box">
            <div class="hint-title">CSV 샘플 컬럼 (권장)</div>
            <code>address,sale_price,appraisal_price,status,region_gu,region_dong,case_no,memo</code>
            <div class="muted small">
              한글 헤더(주소, 매각가, 감정가, 상태, 구, 동, 사건번호, 비고)도 허용하도록 매핑 처리됨.
            </div>
          </div>

          <div class="btn-row">
            <button id="btnCsvPreview" class="btn btn-secondary">미리보기</button>
            <button id="btnCsvUpload" class="btn btn-primary">서버 업로드</button>
          </div>

          <div id="csvResultBox" class="result-box hidden"></div>

          <div class="table-wrap slim">
            <table class="table" id="csvPreviewTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>주소</th>
                  <th>매각가</th>
                  <th>상태</th>
                  <th>구</th>
                  <th>동</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div id="csvPreviewEmpty" class="empty">미리보기 데이터가 없습니다.</div>
          </div>
        </div>
      </section>

      <!-- 담당자 관리 -->
      <section id="tab-staff" class="panel tab-panel hidden">
        <div class="panel-title-row">
          <h2>담당자 어카운트 관리</h2>
        </div>

        <div class="sub-card">
          <form id="staffForm" class="staff-form">
            <input type="hidden" name="id" />
            <label class="field">
              <span>이름 *</span>
              <input name="name" class="input" type="text" required />
            </label>
            <label class="field">
              <span>비밀번호 *</span>
              <input name="password" class="input" type="password" placeholder="신규/재설정 시 입력" />
            </label>
            <label class="field">
              <span>권한</span>
              <select name="role" class="select">
                <option value="agent">담당자</option>
                <option value="admin">관리자</option>
              </select>
            </label>

            <div class="btn-row">
              <button type="submit" class="btn btn-primary">저장</button>
              <button type="button" id="btnStaffReset" class="btn btn-ghost">초기화</button>
            </div>
          </form>
        </div>

        <div class="table-wrap">
          <table class="table" id="staffTable">
            <thead>
              <tr>
                <th>이름</th>
                <th>권한</th>
                <th>담당지역 수</th>
                <th>생성일</th>
                <th>작업</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="staffEmpty" class="empty hidden">담당자가 없습니다.</div>
        </div>
      </section>

      <!-- 담당자 지역 배정 -->
      <section id="tab-regions" class="panel tab-panel hidden">
        <div class="panel-title-row">
          <h2>담당자 지역 배정</h2>
        </div>

        <div class="sub-card">
          <div class="field-row">
            <label class="field">
              <span>담당자 수(X명)</span>
              <input id="agentCountInput" class="input" type="number" min="1" step="1" value="1" />
            </label>

            <label class="field">
              <span>기준 단위</span>
              <select id="regionUnitMode" class="select">
                <option value="auto">자동 (구 수 초과 시 동 단위 재편성)</option>
                <option value="gu">구 단위 고정</option>
                <option value="dong">동 단위 고정</option>
              </select>
            </label>
          </div>

          <div class="btn-row">
            <button id="btnSuggestGrouping" class="btn btn-secondary">자동 그룹핑 제안</button>
            <button id="btnSaveAssignments" class="btn btn-primary">배정 저장</button>
          </div>

          <div class="hint-box">
            <div class="hint-title">자동 그룹핑 로직(초기 버전)</div>
            <ul>
              <li>물건 주소에서 <strong>구/동</strong> 추출</li>
              <li>X명이 구 개수보다 많으면 <strong>동 단위</strong>로 자동 전환</li>
              <li>같은 구 우선, 인접 구는 인접맵(초기 내장) 기준으로 묶는 휴리스틱 적용</li>
            </ul>
          </div>

          <div id="groupSuggestBox" class="group-suggest-box"></div>
        </div>

        <div class="table-wrap">
          <table class="table" id="assignmentTable">
            <thead>
              <tr>
                <th>담당자</th>
                <th>권한</th>
                <th>배정 지역(복수선택 저장)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="assignmentEmpty" class="empty hidden">담당자 계정을 먼저 등록해 주세요.</div>
        </div>
      </section>

      <!-- 중개사무소 정보 -->
      <section id="tab-offices" class="panel tab-panel hidden">
        <div class="panel-title-row">
          <h2>중개사무소 정보</h2>
        </div>

        <div class="sub-card">
          <div class="field-row">
            <label class="field">
              <span>기본정보 CSV 업로드</span>
              <input id="officeCsvFileInput" class="input" type="file" accept=".csv,text/csv" />
            </label>
          </div>

          <div class="hint-box">
            <div class="hint-title">CSV 샘플 컬럼 (권장)</div>
            <code>office_name,branch_name,address,region_gu,region_dong,manager_name,phone,memo</code>
            <div class="muted small">
              핸드폰번호는 아래 표에서 수정하면 자동 저장됩니다(서버 PATCH).
            </div>
          </div>

          <div class="btn-row">
            <button id="btnOfficeCsvPreview" class="btn btn-secondary">미리보기</button>
            <button id="btnOfficeCsvUpload" class="btn btn-primary">서버 업로드</button>
            <button id="btnReloadOffices" class="btn btn-ghost">목록 새로고침</button>
          </div>

          <div id="officeResultBox" class="result-box hidden"></div>

          <div class="table-wrap slim">
            <table class="table" id="officePreviewTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>사무소명</th>
                  <th>주소</th>
                  <th>구</th>
                  <th>동</th>
                  <th>담당자</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div id="officePreviewEmpty" class="empty">미리보기 데이터가 없습니다.</div>
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" id="officeTable">
            <thead>
              <tr>
                <th>사무소명</th>
                <th>지점명</th>
                <th>주소</th>
                <th>구/동</th>
                <th>담당자</th>
                <th>핸드폰번호 (자동저장)</th>
                <th>메모</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="officeEmpty" class="empty hidden">중개사무소 정보가 없습니다.</div>
        </div>
      </section>
    </main>
  </div>

  <!-- 관리자 로그인 모달 -->
  <div id="adminLoginModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="loginModalTitle">로그인</h3>
        <button id="btnAdminLoginClose" class="icon-btn" aria-label="닫기">✕</button>
      </div>
      <form id="adminLoginForm" class="modal-body">
        <label class="field">
          <span>이름</span>
          <input name="name" class="input" type="text" required />
        </label>
        <label class="field">
          <span>비밀번호</span>
          <input name="password" class="input" type="password" required />
        </label>
        <button type="submit" class="btn btn-primary w-full">로그인</button>
        <div id="loginModalHint" class="muted small">관리자/담당자 계정으로 로그인 가능합니다.</div>
      </form>
    </div>
  </div>

  
  <!-- 물건 등록/편집 모달 -->
  <div id="propertyModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card modal-wide">
      <div class="modal-header">
        <h3 id="propertyModalTitle">물건 등록</h3>
        <button id="btnPropertyModalClose" class="icon-btn" aria-label="닫기">✕</button>
      </div>
      <form id="propertyForm" class="modal-body">
        <input type="hidden" name="id" />

        <div class="field-row">
          <label class="field">
            <span>소스 *</span>
            <select name="source" class="select" required>
              <option value="general">일반</option>
              <option value="auction">경매</option>
              <option value="gongmae">공매</option>
            </select>
          </label>

          <label class="field">
            <span>상태 *</span>
            <select name="status" class="select" required>
              <option value="review">검토중</option>
              <option value="active">진행중</option>
              <option value="hold">보류</option>
              <option value="closed">종결</option>
            </select>
          </label>
        </div>

        <label class="field">
          <span>주소 *</span>
          <input name="address" class="input" type="text" placeholder="예) 서울시 강남구 ..." required />
        </label>

        <div class="field-row">
          <label class="field">
            <span>매각가(원)</span>
            <input name="salePrice" class="input" type="text" inputmode="numeric" placeholder="예) 350000000" />
          </label>

          <label class="field">
            <span>감정가(원) (선택)</span>
            <input name="appraisalPrice" class="input" type="text" inputmode="numeric" placeholder="예) 420000000" />
          </label>
        </div>

        <div class="field-row">
          <label class="field">
            <span>구 (선택)</span>
            <input name="regionGu" class="input" type="text" placeholder="예) 강남구" />
          </label>

          <label class="field">
            <span>동 (선택)</span>
            <input name="regionDong" class="input" type="text" placeholder="예) 역삼동" />
          </label>
        </div>

        <div id="assignedAgentField" class="field hidden">
          <span>담당자 (관리자만 변경)</span>
          <select id="assignedAgentSelect" name="assignedAgentId" class="select"></select>
          <div class="muted small">※ 담당자는 저장 후에도 변경 가능합니다.</div>
        </div>

        <label class="field">
          <span>메모 (선택)</span>
          <textarea name="memo" class="textarea" rows="4" placeholder="메모/특이사항"></textarea>
        </label>

        <div class="btn-row">
          <button type="submit" class="btn btn-primary">저장</button>
          <button type="button" id="btnPropertyDelete" class="btn btn-ghost hidden">삭제</button>
        </div>

        <div id="propertyFormMsg" class="muted small"></div>
      </form>
    </div>
  </div>

  <script src="./admin-app.js"></script>
</body>
</html>
